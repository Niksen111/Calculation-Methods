package homeworks.fifth.first

import homeworks.utils.ui.Ui
import homeworks.utils.vo.Seq
import kotlin.math.*

class UiH5P1 : Ui {
    private var homework = Homework5P1()

    private fun setHomework() {
        this.homework = Homework5P1(
        )
    }

    private fun printTaskInfo() {
        println(
            """
                Ð—Ð°Ð´Ð°Ð½Ð¸Ðµ 5.1 Ð¿Ð¾ Ð²Ñ‹Ñ‡Ð¸ÑÐ»Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾Ð¼Ñƒ Ð¿Ñ€Ð°ÐºÑ‚Ð¸ÐºÑƒÐ¼Ñƒ.
                ÐŸÑ€Ð¸Ð±Ð»Ð¸Ð¶Ñ‘Ð½Ð½Ð¾Ðµ Ð²Ñ‹Ñ‡Ð¸ÑÐ»ÐµÐ½Ð¸Ðµ Ð¸Ð½Ñ‚ÐµÐ³Ñ€Ð°Ð»Ð¾Ð² Ð¿Ñ€Ð¸ Ð¿Ð¾Ð¼Ð¾Ñ‰Ð¸ ÐºÐ²Ð°Ð´Ñ€Ð°Ñ‚ÑƒÑ€Ð½Ñ‹Ñ… Ñ„Ð¾Ñ€Ð¼ÑƒÐ» ÐÐ°Ð¸Ð²Ñ‹ÑÑˆÐµÐ¹ ÐÐ»Ð³ÐµÐ±Ñ€Ð°Ð¸Ñ‡ÐµÑÐºÐ¾Ð¹ Ð¡Ñ‚ÐµÐ¿ÐµÐ½Ð¸ Ð¢Ð¾Ñ‡Ð½Ð¾ÑÑ‚Ð¸ (ÐšÐ¤ ÐÐÐ¡Ð¢)
                """.trimIndent()
        )
        println("Ð’Ð°Ñ€Ð¸Ð°Ð½Ñ‚ 10")
        println("f(x) = sin(x)")
        println("p(x) = sqrt(1 - x)")
        println(
            """
            Ð¢ÐµÐ¾Ñ€ÐµÑ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ Ð±Ð»Ð¾Ðº:
                1. Ð·Ð½Ð°Ñ‚ÑŒ, Ñ‡Ñ‚Ð¾ Ñ‚Ð°ÐºÐ¾Ðµ ÐÐ»Ð³ÐµÐ±Ñ€Ð°Ð¸Ñ‡ÐµÑÐºÐ°Ñ Ð¡Ñ‚ÐµÐ¿ÐµÐ½ÑŒ Ð¢Ð¾Ñ‡Ð½Ð¾ÑÑ‚Ð¸ ÐšÐ¤, Ð´Ð²ÑƒÑÑ‚Ð¾Ñ€Ð¾Ð½Ð½ÑŽÑŽ Ð¾Ñ†ÐµÐ½ÐºÑƒ Ð´Ð»Ñ ÐÐ¡Ð¢ Ð˜ÐšÐ¤
                Ð² ÑÐ»ÑƒÑ‡Ð°Ðµ Ð·Ð½Ð°ÐºÐ¾Ð¿Ð¾ÑÑ‚Ð¾ÑÐ½Ð½Ð¾Ð³Ð¾ Ð²ÐµÑÐ°;
                2. Ð·Ð½Ð°Ñ‚ÑŒ, Ñ‡ÐµÐ¼Ñƒ Ñ€Ð°Ð²Ð½Ð° Ð½Ð°Ð¸Ð²Ñ‹ÑÑˆÐ°Ñ ÐÐ¡Ð¢ ÐšÐ¤ Ñ N ÑƒÐ·Ð»Ð°Ð¼Ð¸;
                3. Ð·Ð½Ð°Ñ‚ÑŒ Ñ„Ð¾Ñ€Ð¼ÑƒÐ»Ð¸Ñ€Ð¾Ð²ÐºÑƒ Ñ‚ÐµÐ¾Ñ€ÐµÐ¼Ñ‹ Ð¾ ÐšÐ¤ Ð³Ð°ÑƒÑÑÐ¾Ð²Ð° Ñ‚Ð¸Ð¿Ð° (Ð¸Ð»Ð¸ ÐšÐ¤ ÐÐÐ¡Ð¢);
                4. Ð·Ð½Ð°Ñ‚ÑŒ Ð°Ð»Ð³Ð¾Ñ€Ð¸Ñ‚Ð¼ Ð¿Ð¾ÑÑ‚Ñ€Ð¾ÐµÐ½Ð¸Ñ ÐšÐ¤ ÐÐÐ¡Ð¢ Ð¸ Ð°Ð»Ð³Ð¾Ñ€Ð¸Ñ‚Ð¼ Ð¿Ð¾ÑÑ‚Ñ€Ð¾ÐµÐ½Ð¸Ñ Ð˜ÐšÐ¤.

            ÐžÑ‚Ð²ÐµÑ‚Ñ‹ Ð½Ð° Ñ‚ÐµÐ¾Ñ€ÐµÑ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ Ð±Ð»Ð¾Ðº:
                1. ÐÐ»Ð³ÐµÐ±Ñ€Ð°Ð¸Ñ‡ÐµÑÐºÐ°Ñ ÑÑ‚ÐµÐ¿ÐµÐ½ÑŒ Ñ‚Ð¾Ñ‡Ð½Ð¾ÑÑ‚Ð¸ ÐºÐ²Ð°Ð´Ñ€Ð°Ñ‚ÑƒÑ€Ð½Ð¾Ð¹ Ñ„Ð¾Ñ€Ð¼ÑƒÐ»Ñ‹ â€“ ÑÑ‚Ð¾ Ð¼Ð°ÐºÑÐ¸Ð¼Ð°Ð»ÑŒÐ½Ð°Ñ ÑÑ‚ÐµÐ¿ÐµÐ½ÑŒ Ð¼Ð½Ð¾Ð³Ð¾Ñ‡Ð»ÐµÐ½Ð°,
                 Ð´Ð»Ñ ÐºÐ¾Ñ‚Ð¾Ñ€Ð¾Ð¹ ÐºÐ²Ð°Ð´Ñ€Ð°Ñ‚ÑƒÑ€Ð½Ð°Ñ Ñ„Ð¾Ñ€Ð¼ÑƒÐ»Ð° Ñ‚Ð¾Ñ‡Ð½Ð° Ð´Ð»Ñ Ð²ÑÐµÑ… Ð¼Ð½Ð¾Ð³Ð¾Ñ‡Ð»ÐµÐ½Ð¾Ð² ÑÑ‚ÐµÐ¿ÐµÐ½Ð¸ Ð½Ðµ Ð²Ñ‹ÑˆÐµ ÑÑ‚Ð¾Ð¹. 
                2. d = 2N-1
                3. Ð¢ÐµÐ¾Ñ€ÐµÐ¼Ð° 1
                   Ð”Ð»Ñ Ñ‚Ð¾Ð³Ð¾, Ñ‡Ñ‚Ð¾Ð±Ñ‹ ÐÐ¡Ð¢ ÐšÐ¤ (1) = 2ð‘ âˆ’ 1, Ð½ÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ð¾ Ð¸ Ð´Ð¾ÑÑ‚Ð°Ñ‚Ð¾Ñ‡Ð½Ð¾:
                    1. ðœ”ð‘ (ð‘¥) = âˆï¸€[k=1->N](ð‘¥ âˆ’ ð‘¥ð‘˜), âˆ«ï¸[ð‘Ž,ð‘] ðœŒ(ð‘¥)ðœ”ð‘(ð‘¥)ð‘„ð‘âˆ’1(ð‘¥)dð‘¥ = 0 âˆ€ð‘„ð‘âˆ’1 (2)
                    (ðœ”ð‘ âŠ¥[ðœŒ, (ð‘Ž,ð‘)] ð‘„ð‘âˆ’1 â‡â‡’ ðœ”ð‘ âŠ¥[ðœŒ,(ð‘Ž,ð‘)] 1, ð‘¥, . . . , ð‘¥ð‘âˆ’1)
                    2. ÐšÐ¤ (1) â€” Ð¸Ð½Ñ‚ÐµÑ€Ð¿Ð¾Ð»ÑÑ†Ð¸Ð¾Ð½Ð½Ð°Ñ
                4. ...
                
            ÐŸÑ€Ð°ÐºÑ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ Ð±Ð»Ð¾Ðº:
            ÐŸÐ°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹ Ð·Ð°Ð´Ð°Ñ‡Ð¸: Ð¿Ñ€ÐµÐ´ÐµÐ»Ñ‹ Ð¸Ð½Ñ‚ÐµÐ³Ñ€Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ â€“ ð‘Ž, ð‘ (Ð·Ð°Ð¿Ñ€Ð°ÑˆÐ¸Ð²Ð°Ñ‚ÑŒ Ñƒ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ; Ð²Ð²Ð¾Ð´ÑÑ‚ÑÑ Ñ ÐºÐ»Ð°Ð²Ð¸Ð°Ñ‚ÑƒÑ€Ñ‹), Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¸ ðœŒ(ð‘¥) Ð¸ ð‘“(ð‘¥) (Ð¾Ð¿Ð¸ÑÐ°Ñ‚ÑŒ Ð² ÐºÐ¾Ð´Ðµ Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ñ‹).
                1. ÐÐ°Ð¹Ñ‚Ð¸ "Ñ‚Ð¾Ñ‡Ð½Ð¾Ðµ"Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ I = âˆ«ï¸€ Ð¿Ð¾ a, b  ðœŒ(ð‘¥)ð‘“(ð‘¥) dð‘¥ (Ð¿Ñ€Ð¸ Ð¿Ð¾Ð¼Ð¾Ñ‰Ð¸ Ð¼Ð°Ñ‚Ð¿Ð°ÐºÐµÑ‚Ð° Ð¸Ð»Ð¸ Ð±Ð¸Ð±Ð»Ð¸Ð¾Ñ‚ÐµÐºÐ¸), Ð²Ñ‹Ð²ÐµÑÑ‚Ð¸ ÐµÐ³Ð¾Ð½Ð° Ð¿ÐµÑ‡Ð°Ñ‚ÑŒ.
                2. ÐÐ°Ð¿Ð¸ÑÐ°Ñ‚ÑŒ Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ñƒ, Ð¿Ð¾Ð·Ð²Ð¾Ð»ÑÑŽÑ‰ÑƒÑŽ Ð²Ñ‹Ñ‡Ð¸ÑÐ»Ð¸Ñ‚ÑŒ Ð¿Ñ€Ð¸Ð±Ð»Ð¸Ð¶ÐµÐ½Ð½Ð¾ I Ð¿Ñ€Ð¸ Ð¿Ð¾Ð¼Ð¾Ñ‰Ð¸ Ð˜ÐšÐ¤ Ñ ð‘ ÑƒÐ·Ð»Ð°Ð¼Ð¸ (Ð¼Ð¸Ð½Ð¸Ð¼ÑƒÐ¼, Ñ 2-Ð¼Ñ).
                3. Ð’Ñ‹Ð²Ð¾Ð´Ð¸Ñ‚ÑŒ Ð½Ð° Ð¿ÐµÑ‡Ð°Ñ‚ÑŒ Ð²ÑÐµ Ð¿Ñ€Ð¾Ð¼ÐµÐ¶ÑƒÑ‚Ð¾Ñ‡Ð½Ñ‹Ðµ Ð²Ñ‹Ñ‡Ð¸ÑÐ»ÐµÐ½Ð¸Ñ: Ð¼Ð¾Ð¼ÐµÐ½Ñ‚Ñ‹ Ð²ÐµÑÐ¾Ð²Ð¾Ð¹ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¸, Ð½Ð°Ð¹Ð´ÐµÐ½Ð½Ñ‹Ðµ
                ÑƒÐ·Ð»Ñ‹ Ð¸ ÐºÐ¾ÑÑ„Ñ„Ð¸Ñ†Ð¸ÐµÐ½Ñ‚Ñ‹ Ð¿Ð¾ÑÑ‚Ñ€Ð¾ÐµÐ½Ð½Ð¾Ð¹ Ð˜ÐšÐ¤.
                4. Ð¡Ð´ÐµÐ»Ð°Ñ‚ÑŒ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÑƒ Ð½Ð° Ñ‚Ð¾Ñ‡Ð½Ð¾ÑÑ‚ÑŒ Ð˜ÐšÐ¤ Ð½Ð° Ð¼Ð½Ð¾Ð³Ð¾Ñ‡Ð»ÐµÐ½Ðµ ÑÑ‚ÐµÐ¿ÐµÐ½Ð¸ ð‘ âˆ’ 1, ÐµÑÐ»Ð¸ Ñ‡Ð¸ÑÐ»Ð¾ ÑƒÐ·Ð»Ð¾Ð² ÐšÐ¤ Ñ€Ð°Ð²Ð½Ð¾ ð‘.
                5. Ð’Ñ‹Ð²ÐµÑÑ‚Ð¸ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð½Ð¾Ðµ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ Ð¸Ð½Ñ‚ÐµÐ³Ñ€Ð°Ð»Ð° (Ð½Ðµ Ð¼ÐµÐ½ÐµÐµ 12 Ð·Ð½Ð°ÐºÐ¾Ð² Ð¿Ð¾ÑÐ»Ðµ Ð·Ð°Ð¿ÑÑ‚Ð¾Ð¹).
                6. Ð¡Ñ€Ð°Ð²Ð½Ð¸Ñ‚ÑŒ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð½Ð¾Ðµ Ð¿Ñ€Ð¸ Ð¿Ð¾Ð¼Ð¾Ñ‰Ð¸ Ð˜ÐšÐ¤ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ Ñ "Ñ‚Ð¾Ñ‡Ð½Ñ‹Ð¼"Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸ÐµÐ¼ Ð¸Ð· Ð¼Ð°Ñ‚Ð¿Ð°ÐºÐµÑ‚Ð°.
                7. ÐÐ°Ð¿Ð¸ÑÐ°Ñ‚ÑŒ Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ñƒ, Ð¿Ð¾Ð·Ð²Ð¾Ð»ÑÑŽÑ‰ÑƒÑŽ Ð²Ñ‹Ñ‡Ð¸ÑÐ»Ð¸Ñ‚ÑŒ Ð¿Ñ€Ð¸Ð±Ð»Ð¸Ð¶ÐµÐ½Ð½Ð¾ I Ð¿Ñ€Ð¸ Ð¿Ð¾Ð¼Ð¾Ñ‰Ð¸ ÐšÐ¤ÐÐÐ¡Ð¢ ð‘ (Ð¼Ð¸Ð½Ð¸Ð¼ÑƒÐ¼, Ñ 2-Ð¼Ñ ÑƒÐ·Ð»Ð°Ð¼Ð¸).
                8. Ð’Ñ‹Ð²Ð¾Ð´Ð¸Ñ‚ÑŒ Ð½Ð° Ð¿ÐµÑ‡Ð°Ñ‚ÑŒ Ð²ÑÐµ Ð¿Ñ€Ð¾Ð¼ÐµÐ¶ÑƒÑ‚Ð¾Ñ‡Ð½Ñ‹Ðµ Ð²Ñ‹Ñ‡Ð¸ÑÐ»ÐµÐ½Ð¸Ñ: Ð¼Ð¾Ð¼ÐµÐ½Ñ‚Ñ‹ Ð²ÐµÑÐ¾Ð²Ð¾Ð¹ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¸, Ð½Ð°Ð¹Ð´ÐµÐ½Ð½Ñ‹Ð¹ Ð¾Ñ€Ñ‚Ð¾Ð³Ð¾Ð½Ð°Ð»ÑŒÐ½Ñ‹Ð¹ Ð¼Ð½Ð¾Ð³Ð¾Ñ‡Ð»ÐµÐ½, ÑƒÐ·Ð»Ñ‹ Ð¸ ÐºÐ¾ÑÑ„Ñ„Ð¸Ñ†Ð¸ÐµÐ½Ñ‚Ñ‹ Ð¿Ð¾ÑÑ‚Ñ€Ð¾ÐµÐ½Ð½Ð¾Ð¹ ÐšÐ¤ ÐÐÐ¡Ð¢.
                9. Ð¡Ð´ÐµÐ»Ð°Ñ‚ÑŒ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÑƒ Ð½Ð° ÐºÐ¾ÑÑ„Ñ„Ð¸Ñ†Ð¸ÐµÐ½Ñ‚Ñ‹ Ð¸ Ñ‚Ð¾Ñ‡Ð½Ð¾ÑÑ‚ÑŒ ÐšÐ¤ Ð½Ð° Ð¾Ð´Ð½Ð¾Ñ‡Ð»ÐµÐ½Ðµ ð‘¥^3 (Ð´Ð»Ñ Ð´Ð²ÑƒÑ… ÑƒÐ·Ð»Ð¾Ð²) Ð¸ Ð½Ð° Ð¾Ð´Ð½Ð¾Ñ‡Ð»ÐµÐ½Ðµ ð‘¥^(2ð‘âˆ’1), ÐµÑÐ»Ð¸ Ñ‡Ð¸ÑÐ»Ð¾ ÑƒÐ·Ð»Ð¾Ð² Ñ€Ð°Ð²Ð½Ð¾ ð‘.
                10. Ð’Ñ‹Ð²ÐµÑÑ‚Ð¸ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð½Ð¾Ðµ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ Ð¸Ð½Ñ‚ÐµÐ³Ñ€Ð°Ð»Ð° (Ð½Ðµ Ð¼ÐµÐ½ÐµÐµ 12 Ð·Ð½Ð°ÐºÐ¾Ð² Ð¿Ð¾ÑÐ»Ðµ Ð·Ð°Ð¿ÑÑ‚Ð¾Ð¹).
                11. Ð¡Ñ€Ð°Ð²Ð½Ð¸Ñ‚ÑŒ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð½Ð¾Ðµ Ð¿Ñ€Ð¸ Ð¿Ð¾Ð¼Ð¾Ñ‰Ð¸ ÐšÐ¤ÐÐÐ¡Ð¢ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ Ñ "Ñ‚Ð¾Ñ‡Ð½Ñ‹Ð¼"Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸ÐµÐ¼ Ð¸Ð· Ð¼Ð°Ñ‚Ð¿Ð°ÐºÐµÑ‚Ð°.
            
            """.trimIndent()
        )
        println()
    }

    private fun printCommandList() {
        println("Commands list:")
        println("help                                  -print command list")
        println("back                                  -quit the current task")
        println("tests                                 -run tests")
        println()
    }

    private fun printErr() {
        println("[ERROR]: Wrong command")
        println()
    }

    private fun tests() {
        val seq1 = Seq(0, 1)
        var qfhada = QFHADA(seq1, 2, Homework5P1.p, "sqrt(1 - x)", Homework5P1.f, "sin(x)",
            Homework5P1.pseudoIntegral)
        qfhada.printInfo()
        println()
        qfhada = QFHADA(seq1, 3, Homework5P1.p, "sqrt(1 - x)", Homework5P1.f, "sin(x)",
            Homework5P1.pseudoIntegral)
        qfhada.printInfo()
        println()
        qfhada = QFHADA(seq1, 5, Homework5P1.p, "sqrt(1 - x)", Homework5P1.f, "sin(x)",
            Homework5P1.pseudoIntegral)
        qfhada.printInfo()
        println()
        val exponent = { x: Double -> exp(x) }
        qfhada = QFHADA(seq1, 2, exponent, "exp(x)", { x -> sin(x) }, "sin(x)",
            { seq : Seq -> 0.5 * exp(seq.right) * (sin(seq.right) - cos(seq.right)) - 0.5 * exp(seq.left) * (sin(seq.left) - cos(seq.left)) })
        qfhada.printInfo()
        println()
        qfhada = QFHADA(seq1, 3, exponent, "exp(x)", { x -> sin(x) }, "sin(x)",
            { seq : Seq -> 0.5 * exp(seq.right) * (sin(seq.right) - cos(seq.right)) - 0.5 * exp(seq.left) * (sin(seq.left) - cos(seq.left)) })
        qfhada.printInfo()
        println()
        qfhada = QFHADA(seq1, 5, exponent, "exp(x)", { x -> sin(x) }, "sin(x)",
            { s : Seq -> 0.5 * exp(s.right) * (sin(s.right) - cos(s.right)) - 0.5 * exp(s.left) * (sin(s.left) - cos(s.left)) })
        qfhada.printInfo()
        println()
        qfhada = QFHADA(seq1, 3, exponent, "exp(x)", { x -> x }, "x",
            { s: Seq -> exp(s.right)*(s.right-1) - exp(s.left)*(s.left-1)})
        qfhada.printInfo()
        println()
        qfhada = QFHADA(seq1, 3, exponent, "exp(x)", { x -> x.pow(2) }, "x^2",
            { 0.718281828459045 })
        qfhada.printInfo()
        println()
        qfhada = QFHADA(seq1, 3, exponent, "exp(x)", { x -> x.pow(3) }, "x^3",
            { 0.5634363430819096 })
        qfhada.printInfo()
        println()
        qfhada = QFHADA(seq1, 3, exponent, "exp(x)", { x -> x.pow(5) }, "x^5",
            { 0.3955995478020096 })
        qfhada.printInfo()
        println()
        qfhada = QFHADA(seq1, 3, exponent, "exp(x)", { x -> x.pow(6) }, "x^6",
            { 0.3446845416469874 })
        qfhada.printInfo()
        println()
    }

    override fun start() {
        printTaskInfo()
        printCommandList()
        while (true) {
            try {
                println("Enter a command:")
                val input = readln().split(" ")

                if (input.isEmpty() || input.size > 3) {
                    printErr()
                    continue
                }

                when (input.first()) {
                    "help" -> {
                        if (input.size > 1) {
                            printErr()
                            continue
                        }

                        printCommandList()
                    }
                    "back" -> {
                        if (input.size > 1) {
                            printErr()
                            continue
                        }

                        break
                    }
                    "tests" -> {
                        if (input.size > 1) {
                            printErr()
                            continue
                        }

                        tests()
                    }
                    else -> {
                        printErr()
                    }
                }
            } catch (e: Exception) {
                e.printStackTrace()
            }
        }
    }
}